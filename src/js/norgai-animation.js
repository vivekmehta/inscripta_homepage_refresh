
// Auto-play animation when scrolled into view
document.addEventListener('DOMContentLoaded', function() {
    const animationSection = document.querySelector('.norgai-animation-section');
    
    if (!animationSection) return;
    
    // PERFORMANCE: Pause CSS animations when not in view
    const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                animationSection.classList.add('in-view');
                animationSection.classList.remove('animations-paused');
                // Auto-start animation when in view
                if (!isRunning) {
                    setTimeout(() => runSequence(), 500);
                }
            } else {
                // Pause animations when scrolled away
                animationSection.classList.add('animations-paused');
            }
        });
    }, {
        threshold: 0.2
    });
    
    observer.observe(animationSection);
});


let currentStep = 'upload';
let isRunning = false;

const steps = {
    upload: document.getElementById('step-upload'),
    chat: document.getElementById('step-chat'),
    processing: document.getElementById('step-processing'),
    result: document.getElementById('step-result')
};

function wait(ms) {
    return new Promise(resolve => setTimeout(resolve, ms));
}

function showStep(step) {
    Object.values(steps).forEach(el => {
    el.classList.remove('active');
    });
    steps[step].classList.add('active');
    currentStep = step;
}
async function animatePPTInsertion() {
    const thumbnailsContainer = document.getElementById('slide-thumbnails');
    const mainSlide = document.getElementById('main-slide');
    
    // Clear existing single thumbnail
    thumbnailsContainer.innerHTML = '';
    
    // Create 8 slide thumbnails with staggered animation
    const slideContent = [
        { title: 'Title Slide', lines: 2 },
        { title: 'Executive Summary', lines: 4 },
        { title: 'Scope & Objectives', lines: 3 },
        { title: 'Timeline', lines: 3 },
        { title: 'Budget Breakdown', lines: 4 },
        { title: 'Team Structure', lines: 3 },
        { title: 'Risk Analysis', lines: 4 },
        { title: 'Next Steps', lines: 2 }
    ];
    
    for (let i = 0; i < slideContent.length; i++) {
        await wait(200);
        const thumb = document.createElement('div');
        thumb.className = 'ppt-slide-thumb';
        thumb.innerHTML = `
        <div class="thumb-title"></div>
        ${Array(slideContent[i].lines).fill('<div class="thumb-line"></div>').join('')}
        `;
        thumbnailsContainer.appendChild(thumb);
        
        // Trigger animation
        setTimeout(() => thumb.classList.add('animate-in'), 10);
    }
    
    // Update main slide with sample content
    mainSlide.innerHTML = `
        <div style="padding: 3rem; height: 100%; display: flex; flex-direction: column; background: white;">
        <div style="border-bottom: 3px solid #c7372f; padding-bottom: 1.5rem; margin-bottom: 2rem;">
            <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1rem;">
            <div style="width: 60px; height: 60px; background: linear-gradient(135deg, #c7372f, #a12e27); border-radius: 8px;"></div>
            <div style="flex: 1;">
                <h1 style="font-size: 2.5rem; font-weight: 700; color: #1e293b; margin: 0;">Apex Solutions</h1>
                <p style="font-size: 1.1rem; color: #64748b; margin: 0.5rem 0 0 0;">Strategic Expansion Proposal</p>
            </div>
            </div>
        </div>
        <div style="flex: 1; display: grid; grid-template-columns: 1fr 1fr; gap: 2rem;">
            <div>
            <h3 style="color: #c7372f; margin-bottom: 1rem;">Project Overview</h3>
            <div style="height: 8px; background: #e2e8f0; border-radius: 4px; margin-bottom: 0.75rem;"></div>
            <div style="height: 8px; background: #e2e8f0; border-radius: 4px; width: 85%; margin-bottom: 0.75rem;"></div>
            <div style="height: 8px; background: #e2e8f0; border-radius: 4px; width: 70%;"></div>
            </div>
            <div>
            <h3 style="color: #c7372f; margin-bottom: 1rem;">Key Deliverables</h3>
            <div style="height: 8px; background: #e2e8f0; border-radius: 4px; margin-bottom: 0.75rem;"></div>
            <div style="height: 8px; background: #e2e8f0; border-radius: 4px; width: 90%; margin-bottom: 0.75rem;"></div>
            <div style="height: 8px; background: #e2e8f0; border-radius: 4px; width: 65%;"></div>
            </div>
        </div>
        <div style="margin-top: auto; padding-top: 2rem; border-top: 1px solid #e2e8f0; display: flex; justify-content: space-between; align-items: center;">
            <div style="font-size: 0.875rem; color: #94a3b8;">Generated by NorgAI</div>
            <div style="font-size: 0.875rem; color: #94a3b8;">Slide 1 of 8</div>
        </div>
        </div>
    `;
}

async function runSequence() {
    if (isRunning) return;
    isRunning = true;

    // Step 1: Upload (show the step)
    showStep('upload');
    await wait(500);

    const thumbnailsContainer = document.getElementById('slide-thumbnails');
    const mainSlide = document.getElementById('main-slide');
    
    // Show thumbnail sidebar from the start
    thumbnailsContainer.classList.add('visible');
    mainSlide.classList.add('with-sidebar');
    
    // Add single empty slide thumbnail
    thumbnailsContainer.innerHTML = `
        <div class="ppt-slide-thumb animate-in">
        <div class="thumb-title"></div>
        <div class="thumb-line" style="width: 60%;"></div>
        <div class="thumb-line" style="width: 40%;"></div>
        </div>
    `;
    
    // Show empty slide in main area
    mainSlide.innerHTML = `
        <div style="width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; background: white;">
        <div style="width: 90%; height: 90%; border: 2px dashed #cbd5e1; border-radius: 8px; display: flex; flex-direction: column; align-items: center; justify-content: center; color: #94a3b8;">
            <div style="font-size: 2rem; margin-bottom: 0.5rem;">Click to add title</div>
            <div style="font-size: 1rem;">Click to add subtitle</div>
        </div>
        </div>
    `;

    // Show upload progress
    document.getElementById('upload-empty').style.display = 'none';
    document.getElementById('upload-progress').style.display = 'flex';

    for (let i = 10; i <= 100; i += 10) {
    document.getElementById('progress-fill').style.width = i + '%';
    await wait(150);
    }

    document.getElementById('upload-complete').style.display = 'flex';
    await wait(500);

    // ADD THIS FOR SECOND FILE:
    document.getElementById('upload-progress-2').style.display = 'flex';

    for (let i = 10; i <= 100; i += 10) {
    document.getElementById('progress-fill-2').style.width = i + '%';
    await wait(100);
    }

    document.getElementById('upload-complete-2').style.display = 'flex';
    await wait(2000);

    // Step 2: Chat
    showStep('chat');
    document.getElementById('user-message').style.opacity = '0';
    await wait(2500);
    document.getElementById('user-message').style.opacity = '1';
    document.getElementById('user-message').style.animation = 'slideInRight 0.4s ease forwards';
    await wait(3500);

    // Step 3: Processing
    showStep('processing');
    await wait(5000);

    // Step 4: Result
    showStep('result');
    await wait(1500);
    
    // Trigger PPT animation when "Insert PPT" is clicked
    const insertButton = document.querySelector('.action-button.outline');
    insertButton.addEventListener('click', async function() {
    await animatePPTInsertion();
    }, { once: true });
    
    await wait(2000);
    // Auto-trigger the insert animation
    await animatePPTInsertion();
    
    await wait(6000);

    // Reset
    document.getElementById('slide-thumbnails').classList.remove('visible');
    document.getElementById('main-slide').classList.remove('with-sidebar');
    document.getElementById('slide-thumbnails').innerHTML = '';
    document.getElementById('main-slide').innerHTML = '';
    
    // Reset upload section
    document.getElementById('upload-empty').style.display = 'block';
    document.getElementById('upload-progress').style.display = 'none';
    document.getElementById('upload-progress-2').style.display = 'none';
    document.getElementById('progress-fill').style.width = '0%';
    document.getElementById('progress-fill-2').style.width = '0%';
    document.getElementById('upload-complete').style.display = 'none';
    document.getElementById('upload-complete-2').style.display = 'none';
    
    isRunning = false;
    await wait(500);
    runSequence();
}

// Start the sequence
runSequence();





// Scroll-Linked Progressive Text Reveal
document.addEventListener('DOMContentLoaded', function() {
    const scrollValueSection = document.querySelector('.scroll-value-section');
    
    if (!scrollValueSection) return;
    
    const revealWords = scrollValueSection.querySelectorAll('.reveal-word');
    
    function updateReveal() {
        const rect = scrollValueSection.getBoundingClientRect();
        const windowHeight = window.innerHeight;
        
        // Calculate how much of the section is visible
        const sectionTop = rect.top;
        const sectionHeight = rect.height;
        
        // Start revealing when section enters viewport
        // Complete reveal when section is centered
        const revealStart = windowHeight * 0.8;
        const revealEnd = windowHeight * 0.3;
        
        if (sectionTop < revealStart && sectionTop > revealEnd - sectionHeight) {
            // Calculate progress (0 to 1)
            const progress = 1 - ((sectionTop - revealEnd) / (revealStart - revealEnd));
            const clampedProgress = Math.max(0, Math.min(1, progress));
            
            // Reveal words progressively
            revealWords.forEach((word, index) => {
                const wordProgress = clampedProgress * revealWords.length;
                
                if (wordProgress > index) {
                    word.classList.add('visible');
                    
                    // Fine-tune opacity based on progress
                    const wordOpacity = Math.min(1, (wordProgress - index) * 2);
                    word.style.opacity = wordOpacity;
                } else {
                    word.classList.remove('visible');
                    word.style.opacity = 0;
                }
            });
        } else if (sectionTop >= revealStart) {
            // Section not yet in view - hide all
            revealWords.forEach(word => {
                word.classList.remove('visible');
                word.style.opacity = 0;
            });
        } else if (sectionTop <= revealEnd - sectionHeight) {
            // Section scrolled past - show all
            revealWords.forEach(word => {
                word.classList.add('visible');
                word.style.opacity = 1;
            });
        }
    }
    
    // Update on scroll
    let ticking = false;
    window.addEventListener('scroll', function() {
        if (!ticking) {
            window.requestAnimationFrame(function() {
                updateReveal();
                ticking = false;
            });
            ticking = true;
        }
    });
    
    // Initial check
    updateReveal();
});






// Workflow Animation JavaScript
// This file handles any additional interactive functionality

document.addEventListener('DOMContentLoaded', function() {
  // Add smooth scroll behavior
  document.documentElement.style.scrollBehavior = 'smooth';

  // Optional: Add click handlers for step cards
  const stepCards = document.querySelectorAll('.step-card');
  
  stepCards.forEach((card, index) => {
    card.addEventListener('click', function() {
      console.log(`Step ${index + 1} clicked`);
      // You can add custom functionality here
    });
  });

  // Optional: Restart animations on visibility change
  document.addEventListener('visibilitychange', function() {
    if (!document.hidden) {
      // Restart animations when tab becomes visible
      const fadeItems = document.querySelectorAll('.fade-in-item');
      fadeItems.forEach(item => {
        item.style.animation = 'none';
        setTimeout(() => {
          item.style.animation = '';
        }, 10);
      });
    }
  });

  // Optional: Add intersection observer for scroll animations
  if ('IntersectionObserver' in window) {
    const observer = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          entry.target.classList.add('visible');
        }
      });
    }, {
      threshold: 0.1
    });

    // Observe elements if needed
    const elementsToObserve = document.querySelectorAll('.step-card');
    elementsToObserve.forEach(el => observer.observe(el));
  }

  // Log initialization
  console.log('NorgAI Workflow Animation initialized');
});

// Optional: Add resize handler for responsive adjustments
window.addEventListener('resize', function() {
  // Add any responsive logic here if needed
  const width = window.innerWidth;
  if (width < 768) {
    console.log('Mobile view');
  } else {
    console.log('Desktop view');
  }
});


